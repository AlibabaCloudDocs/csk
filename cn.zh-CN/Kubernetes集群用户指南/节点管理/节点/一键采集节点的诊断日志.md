---
keyword: [容器服务Kubernetes, 采集多个节点日志, k8s]
---

# 一键采集节点的诊断日志

您可以通过容器服务Kubernetes版控制台同时诊断多个节点并采集相关日志信息。本文介绍如何一键采集被诊断节点的日志。

-   [创建Kubernetes托管版集群](/cn.zh-CN/Kubernetes集群用户指南/集群管理/创建集群/创建Kubernetes托管版集群.md)
-   [开通OSS服务](/cn.zh-CN/控制台用户指南/开通OSS服务.md)

## 授权将日志采集到OSS

如果您希望将诊断日志采集到OSS中，需要给节点授权，向OSS指定目录写入数据。操作步骤如下。

1.  云账号登录[RAM控制台](https://ram.console.aliyun.com/)。

2.  在左侧导航栏的**权限管理**菜单下，单击**权限策略管理**。

3.  在**权限策略名称**列表下，单击目标权限策略名称。

    **说明：** RAM支持两种权限策略，其中系统策略只能查看不能修改，自定义策略可以创建、查看和修改。

4.  在**策略内容**页签下，单击**修改策略内容**。

5.  在**修改策略内容**面板中增加以下授权规则，并填入您的Bucket名称和存放目录。

    ![修改策略](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4675659951/p127244.png)

    ```
    {
        "Action": [
            "oss:GetBucket",
            "oss:PutObject",
            "oss:GetObject"
        ],
        "Resource": [
            "acs:oss:*:*:<bucket名称>/<存放诊断日志的目录>/*"
        ],
        "Effect": "Allow"
    },
    {
        "Action": [
            "oss:GetBucketInfo"
        ],
        "Resource": [
            "acs:oss:*:*:<bucket名称>"
        ],
        "Effect": "Allow"
    }
    ```

6.  单击**确定**。


## 选择节点进行诊断

1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)。

2.  在控制台左侧导航栏中，单击**集群**。

3.  在集群列表页面中，单击目标集群名称或者目标集群右侧**操作**列下的**详情**。

4.  在集群管理页左侧导航栏中，选择**节点管理** \> **节点**。

5.  在控制台左侧导航栏，选择**集群** \> **节点**。

6.  在节点页面，选择需要被诊断的节点，然后单击**节点诊断**。

7.  在节点诊断对话框中，执行以下操作。

    -   选中**上传到OSS**，然后执行以下操作。

        您可以将采集日志上传到OSS Bucket中。进行此步骤前，需要授权角色将日志采集到OSS，请参见[授权将日志采集到OSS](#section_zq3_ob1_8gb)。

        1.  填写OSS Bucket的名称和目录。

            例如，希望在myBucket的/acs/diagnose目录中上传诊断日志，您可以填入myBucket/acs/diagnose。

            ![节点诊断2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5675659951/p127252.png)

        2.  设置是否选中**共享诊断日志**。

            如果选中系统会为诊断日志生成一个临时链接，您可以直接下载链接，也可以将链接共享给ACK支持团队协助诊断。

        3.  单击**确定**。

            完成上述操作后，您可以在控制台获取云助手**任务ID**， 根据此ID在ECS云助手控制台查看诊断脚本的执行日志。

        4.  在节点诊断对话框，单击**在云助手控制台查看诊断脚本执行日志**链接。
        5.  在云助手页面，单击**命令执行结果**页签。
        6.  找到目标**命令执行ID**，然后在其右侧单击**查看**。

            您可以在[OSS控制台](https://oss.console.aliyun.com)中对应的目录查看采集的诊断文件。

            ![诊断文件](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5675659951/p127265.png)

    -   不选中**上传到OSS**，然后单击**确认**。

        如果不选中**上传到OSS**，您无需授权角色将日志采集到OSS。您可登录[ECS控制台](https://ecs.console.aliyun.com/)，选择**运维与监控** \> **发送命令/文件（云助手）** \> **命令执行结果**，查看相关诊断日志文件。


