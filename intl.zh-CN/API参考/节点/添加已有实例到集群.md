# 添加已有实例到集群

调用AttachInstances添加已有ECS实例到集群。

## 调试

[您可以在OpenAPI Explorer中直接运行该接口，免去您计算签名的困扰。运行成功后，OpenAPI Explorer可以自动生成SDK代码示例。](https://api.aliyun.com/#product=CS&api=AttachInstances&type=ROA&version=2015-12-15)

## 请求头

该接口使用公共请求头，无特殊请求头。更多信息，请参见[公共请求参数](~~167755~~)。

## 请求语法

```
POST /clusters/{ClusterId}/attach 
```

## 请求参数

|名称|类型|位置|是否必选|示例值|描述|
|--|--|--|----|---|--|
|ClusterId|String|Path|是|c106f377e16f34eb1808d6b9362c9\*\*\*\*|集群ID。 |
| |Object|Body|否| |请求体参数。 |
|instances|Array of String|Body|是|i-2zed0sswuau6o89b\*\*\*\*|实例ID。 |
|key\_pair|String|Body|是|secrity-key|密钥对名称，和`login_password`二选一。 |
|password|String|Body|是|Hello1234|SSH登录密码，和`key_pair`二选一。密码规则为8~30个字符，且至少同时包含三项（大小写字母、数字和特殊符号），不支持反斜线（\\）和半角双引号（"）两个符号。。

 出于安全性考虑，密码传输过程中都是经过加密处理的。 |
|format\_disk|Boolean|Body|否|false|数据盘挂载。取值：

 -   `true`：将容器和镜像存储在数据盘。
-   `false`：不将容器和镜像存储在数据盘。

 默认值：`false`。

 **说明：** **说明**：数据盘内原有数据将丢失，请注意备份数据。

 数据盘挂载规则：

 -   如果 ECS 已挂载数据盘，且最后一块数据盘的文件系统未初始化，系统会自动将该数据盘格式化为 ext4，用来存放内容/var/lib/docker、/var/lib/kubelet 。
-   如果 ECS 未挂载数据盘，则不会挂载新的数据盘。 |
|keep\_instance\_name|Boolean|Body|否|true|是否保留原实例名称。取值：

 -   `true`：保留实例名称。
-   `false`：不保留实例名称。

 默认值：`true`。 |
|is\_edge\_worker|Boolean|Body|否|false|是否为边缘节点，即ENS节点。取值：

 -   `true`：表示添加的节点是边缘节点。
-   `false`：表示添加的节点是不是边缘节点。

 默认值：`false`。

 **说明：** **说明**：如果是边缘节点，取值必须是`true`,用于标识该节点类型为ENS节点。 |
|nodepool\_id|String|Body|否|np615c0e0966124216a0412e10afe0\*\*\*\*|节点池ID。如果不指定，则将节点添加到默认节点池中。 |
|image\_id|String|Body|否|aliyun\_2\_1903\_x64\_20G\_alibase\_20200529.vhd|自定义镜像ID，如果不传则使用默认系统镜像。

 **说明：** **注意**：实例系统盘镜像将被替换为该镜像。 |
|cpu\_policy|String|Body|否|none|节点CPU管理策略。当集群版本在1.12.6及以上时支持以下两种策略：

 -   `static`：允许为节点上具有某些资源特征Pod增强其CPU亲和性和独占性。
-   `none`：表示启用现有的默认CPU亲和性方案。

 默认值：`none`。 |
|user\_data|String|Body|否|IyEvdXNyL2Jpbi9iYXNoCmVjaG8gIkhlbGxvIEFDSyEi|节点自定义数据。更多详情，请参见[生成实例自定义数据](https://help.aliyun.com/document_detail/~~49121~~)。 |
|rds\_instances|Array of String|Body|否|rm-67yawhau\*\*\*\*|RDS实例ID。 |
|runtime|[runtime](/intl.zh-CN/API参考/通用数据结构.md)|Body|否| |容器运行时。 |
|tags|Array of [tag](/intl.zh-CN/API参考/通用数据结构.md)|Body|否| |节点标签。标签定义规则：

 -   标签由区分大小写的键值对组成，您最多可以设置20个标签。
-   标签键不可以重复，最长为64个字符；标签值可以为空，最长为128个字符。标签键和标签值都不能以“aliyun”、“acs:”、“https://”或“http://”开头。详情请参见[Labels and Selectors](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#syntax-and-character-set)。 |

## 返回数据

|名称|类型|示例值|描述|
|--|--|---|--|
|list|Array of list| |节点添加信息列表。 |
|code|String|200|节点添加结果状态码。 |
|instanceId|String|i-2ze0lgm3y6iylcbt\*\*\*\*|实例ID。 |
|message|String|successful|节点添加结果描述信息。 |
|task\_id|String|T-5a544aff80282e39ea000039|任务ID。 |

## 示例

请求示例

```
POST /clusters/c106f377e16f34eb1808d6b9362c9****/attach
{
    "instances":[
        "i-bp1cx67yawhauu49****",
        "i-bp1gjgz24prm1vau****"
    ],
    "format_disk":false,
    "keep_instance_name":true,
    "tags":[
        {
            "key":"tier",
            "value":"frontend"
        }
    ],
    "user_data":"IyEvdXNyL2Jpbi9iYXNoCmVjaG8gIkhlbGxvIEFDSyEi",
    "cpu_policy":"none",
    "password":"Hello1234"
}
```

正常返回示例

`XML` 格式

```
<task_id>T-5a544aff80282e39ea000039</task_id>
<list>
    <code>200</code>
    <instanceId>i-bp1cx67yawhauu49****</instanceId>
    <message>successful</message>
</list>
<list>
    <code>200</code>
    <instanceId>i-bp1gjgz24prm1vau****</instanceId>
    <message>successful</message>
</list>
```

`JSON` 格式

```
{
  "task_id": "T-5a544aff80282e39ea000039",
  "list": [
    {
      "code": "200",
      "instanceId": "i-bp1cx67yawhauu49****",
      "message": "successful"
    },
    {
      "code": "200",
      "instanceId": "i-bp1gjgz24prm1vau****",
      "message": "successful"
    }
  ]
}
```

## 错误码

访问[错误中心](https://error-center.alibabacloud.com/status/product/CS)查看更多错误码。

