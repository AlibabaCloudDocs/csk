# 将事件中心接入注册集群

注册的集群接入事件中心能记录Kubernetes集群的状态变更，包括配置Pod及组件异常等。Kubernetes事件中心功能实时汇聚Kubernetes中的所有事件并提供存储、查询、分析、可视化、告警等能力。本文介绍如何通过容器服务Kubernetes版中的应用将事件中心接入至注册的Kubernetes集群。

您已通过容器服务Kubernetes版接入一个注册的Kubernetes集群。具体操作步骤，请参见[注册外部Kubernetes集群](/intl.zh-CN/Kubernetes集群用户指南/多云混合云管理/注册外部Kubernetes集群.md)。

## 步骤一：接入NPD

1.  登录[容器服务管理控制台](https://cs.console.aliyun.com)[容器服务管理控制台](https://partners-intl.console.aliyun.com/#/cs)。

2.  在控制台左侧导航栏中，选择**市场** \> **应用目录**。

3.  在**应用目录**页面单击**阿里云应用**页签，选中并单击**ack-node-problem-detector**应用。

    **阿里云应用**包含较多应用，您可在页面右上角搜索**ack-node-problem-detector**，支持关键字搜索。

4.  在**应用目录 - ack-node-problem-detector**页面单击**参数**页签，设置相应的参数。

    |参数|描述|
    |--|--|
    |alibaba\_cloud\_plugins|删除**ram\_role\_check**。另外，当机器没有GPU卡时，删除**nvidia\_gpu\_check**。 |
    |serviceaccount|填入拥有管理员权限的serviceaccount。您可以执行`kubectl -n kube-system get sa`查看serviceaccount。详情请查看[在CloudShell上通过kubectl管理Kubernetes集群](/intl.zh-CN/Kubernetes集群用户指南/集群管理/连接集群/在CloudShell上通过kubectl管理Kubernetes集群.md)。|
    |env|填入**AccessKeyId**、**AccessKeySecret**、**RegionId**三个参数。|
    |sls|enabled|如果需要将Event归档到日志服务，则设置**enabled**为**true**。|
    |topic|填写您的集群可读名称。|
    |project|填写您的集群对应的日志服务 Project名称。|
    |logstore|填写project下已有的某个logstore（如果要使用日志服务的事件中心功能，˙这里要填为**k8s-event**）。|
    |internal|如果有专线，则设置为**true**，否则为**false**。|
    |dingtalk|enabled|如果需要将Event告警发送到钉钉群，则设置**enabled**为**true**。|
    |monitorkinds|选择要接收的告警类型，取值：    -   Node
    -   Pod
如果告警只发送到钉钉，建议只选**Node**。|
    |token|填入钉钉群助手的token。Token可以从钉钉群助手的URL中获取。|
    |eventbridge|enabled|如果需要将Event告警发送到事件总线EventBridge，则设置**enabled**为**true**。|

5.  在**应用目录 - ack-node-problem-detector**页面右侧**创建**区域，选择目标集群，然后单击**创建**。


## 步骤二：创建事件中心

1.  登录[日志服务控制台](https://sls.console.aliyun.com)[日志服务控制台](https://partners-intl.console.aliyun.com/#/sls)。

2.  在**日志应用**区域，单击**K8s事件中心**。

3.  在**事件中心管理**页面的右上角，单击**添加**。

4.  在**创建事件中心**面板，根据界面提示配置相关参数。

    -   选择**已有Project**，可从**Project**下拉框中选择已创建的Project。

        **说明：** **Project**为对应集群的**日志服务 Project**名称。

    -   选择**从容器服务选择K8s集群**，可从**K8s集群**下拉框中选择已创建的K8s集群。通过此方式创建事件中心，默认创建一个名为k8s-log-\{cluster-id\}的Project。
5.  单击**下一步**，完成创建。

    **说明：** 创建事件中心后，默认在您选择的日志服务Project中创建一个名为k8s-event的Logstore，并创建相关联的报表和告警等。


配置成功后，即可使用事件中心功能。更多信息，请参见[使用事件中心](https://help.aliyun.com/document_detail/150476.html?spm=a2c6h.12873639.0.0.53116056SIry63#title-sn5-lr5-dmk)。

将事件中心接入注册的Kubernetes集群后，即可使用K8s事件中心，包括查看事件总览、查询事件详情、查看Pod生命周期、配置告警和自定义查询等操作。

**相关文档**  


[注册外部集群简介](/intl.zh-CN/Kubernetes集群用户指南/多云混合云管理/注册外部集群简介.md)

