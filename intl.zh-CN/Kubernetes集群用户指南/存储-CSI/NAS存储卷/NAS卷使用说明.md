---
keyword: [NAS数据卷, 使用限制]
---

# NAS卷使用说明

您可以在容器服务Kubernetes集群中使用阿里云NAS数据卷。本文介绍NAS数据卷的相关注意事项及使用限制。

目前阿里云NAS支持两种CSI挂载方式：

-   静态存储卷挂载
-   动态存储卷挂载

## 前提条件

使用NAS数据卷之前，您需要在[文件存储管理控制台](https://nas.console.aliyun.com/)上创建文件系统，并在文件系统中添加挂载点。创建的NAS文件系统挂载点需要和您的集群位于同一VPC。

例如，您的挂载点为`055f84ad83-ixxxx.cn-hangzhou.nas.aliyuncs.com`格式。

## 注意事项

-   NAS为共享存储，可以同时为多个Pod提供共享存储服务，即一个PVC可以同时被多个Pod使用。
-   在没有卸载NAS文件系统前，务必不要删除NAS挂载点，否则会造成操作系统无响应。
-   NAS挂载点创建后，等待一定时间，待挂载点Ready后方可使用。
-   数据卷挂载协议推荐使用NAS v3。
-   使用NAS数据卷前，推荐升CSI到最新版本。

## 使用限制

**产品规格限制**

|产品项|规格|
|---|--|
|每个账号在单个地域内可创建的文件系统数量|20个|
|单个文件系统可创建挂载点的数量|-   通用型NAS：2个
-   极速型NAS：1个 |
|单个文件系统最大文件数|10亿|
|单个文件系统最大目录层级|1000级|
|单个文件系统容量上限|-   容量型NAS：10 PiB
-   性能型NAS：1 PiB
-   极速型NAS：256 TiB |
|单个文件系统可以挂载计算节点的数量|1000个|
|单个文件的容量上限|32 TiB|
|单个文件支持的硬链接数量|511个|

**操作系统限制**

-   文件存储NAS对操作系统镜像进行了充分的验证，为获得文件系统的更优性能，建议您使用推荐内核镜像及其升级版本。对于不在此推荐列表中的镜像，文件存储NAS将无法承诺其可用性。更多信息，请参见[推荐内核镜像]()。
-   文件存储NAS已定位部分存在问题的内核版本，并给出了处理方案。如果您继续使用存在问题的内核版本而不升级，文件存储NAS将无法承诺其可用性。新定位出的内核版本适配问题，将通过邮件、站内信、短信、控制台公告等方式向您推送，请您确保以上通信通道畅通并及时处理。更多信息，请参见[客户端已知问题]()。
-   macOS操作系统仅支持挂载SMB文件系统。
-   文件存储NAS不支持AIX操作系统。

**协议类型限制**

-   NFS文件系统
    -   单个文件名的最大长度：255 Byte。
    -   NFSv4.0不支持的属性包括：`FATTR4_MIMETYPE`、`FATTR4_QUOTA_AVAIL_HARD`、`FATTR4_QUOTA_AVAIL_SOFT`、`FATTR4_QUOTA_USED`、`FATTR4_TIME_BACKUP`、`FATTR4_TIME_CREATE、FATTR4_ARCHIVE`。如果使用了这些属性，/var/log/messages中会显示`NFS4ERR_ATTRNOTSUPP`错误。
    -   NFSv4.0不支持的操作命令字包括：`OP_DELEGPURGE`、`OP_DELEGRETURN`、`NFS4_OP_OPENATTR`。如果使用了这些不支持的操作命令字，/var/log/messages中会显示`NFS4ERR_ATTRNOTSUPP`错误。
    -   NFSv4.0暂不支持Delegation功能。
    -   不支持NFSv4.1协议。
    -   不支持POSIX SetUID、SetGID、Sticky Bits功能。
    -   UID与GID说明
        -   对于NFSv3协议，如果Linux本地账号中存在文件所属的UID或GID，则根据本地UID和GID映射关系显示相应的用户名和组名；如果本地账号不存在文件所属的UID或GID，则直接显示UID和GID。
        -   对于NFSv4.0协议，如果本地Linux内核版本低于3.0，则所有文件的UID和GID都将显示`nobody`；如果内核版本高于3.0，则显示规则与NFSv3协议相同。

            **说明：** 若使用NFSv4.0协议挂载文件系统，且Linux内核版本低于3.0，建议您不要对文件或目录执行`chown`或`chgrp`命令，否则该文件或目录的UID和GID将变为`nobody`。

    -   NFS客户端限制
        -   通用型NAS单个NFS客户端最多允许128个并发请求。
        -   通用型NAS单个NFS客户端读写带宽总和最大为500 MB/s。
        -   NFS客户端上最多可同时打开32768个文件。list目录及其下面的文件不会被统计为打开文件。
        -   NFS客户端上的每个挂载实例最多可以在256个文件或进程中获取8192个锁。例如：单个进程可以在256个单独文件上获取一个或多个锁，或者8个进程中的每个进程均可以在32个文件上获取一个或多个锁。
        -   不推荐在Windows操作系统上使用NFS客户端访问NFS文件系统。
-   SMB文件系统
    -   单个文件名的最大长度：255个UTF-16字符。
    -   功能限制
        -   不支持文件扩展属性（Extended attributes）以及基于Lease的客户端缓存。
        -   不支持Sparse files、文件压缩、网卡状态查询、重解析点（Reparse Point）等IOCTL或FSCTL操作。
        -   不支持交换数据流（Alternate Data Streams）。
        -   不支持LDAP身份认证功能。
        -   不支持SMB文件传输协议的Direct、SMB Multichannel、SMB Directory Leasing及Persistent File Handle功能。
    -   协议版本支持

        支持SMB 2.1及以上版本。

    -   SMB客户端限制

        在所有挂载文件系统的计算节点上和所有共享访问文件系统的用户中，任何一个特定文件或目录最多可以同时被打开8192次，即8192个活跃文件句柄。文件系统级别最多可以有65536个活跃文件句柄。


**经典网络限制**

-   不支持ECS实例跨账号挂载NAS文件系统。
-   由于内核限制可能出现挂载点IP地址变更的情况，导致NAS文件系统不可访问。

    文件存储NAS会提前30日通过邮件、站内信、短信、智能语音提醒与控制台公告等方式向您推送挂载点IP变更信息。请您于推送日起30日内重新挂载文件系统。


